<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Readme</title>
    <meta name="description" content="Geologist.Researcher.Developer">
    <meta name="author" content='Trygvi Bech Árting'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/sass/researcher.min.css">

    
        <link rel="icon" type="image/ico" href="http://tarting.github.io/favicon.ico">
    

    
        
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    
    <script src="/js/header.js"></script>

</head>

    <body>
        <header class="nav-down"><div class="container">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="http://tarting.github.io/" title="Trygvi Bech Árting">
          
          
          Trygvi Bech Árting
        </a>
        
        
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class=" nav-item nav-link " href="/resume" title="Resume">
                        Resume
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class=" nav-item nav-link " href="/research" title="Research">
                        Research
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class=" nav-item nav-link nav-current " href="/repository" title="Repo">
                        Repo
                    </a>
                    
                
            
        </div>
    </nav>
</div>
</header>
        
        <div class="headerdiv nav-down"><div class="container">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="http://tarting.github.io/" title="Trygvi Bech Árting">
          
          
          Trygvi Bech Árting
        </a>
        
        
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class=" nav-item nav-link " href="/resume" title="Resume">
                        Resume
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class=" nav-item nav-link " href="/research" title="Research">
                        Research
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class=" nav-item nav-link nav-current " href="/repository" title="Repo">
                        Repo
                    </a>
                    
                
            
        </div>
    </nav>
</div>
</div>
        
        <div id="content">
<div class="container">
<div class="navbar-nav flex-row flex-wrap justify-content-center">


    <a class="nav-item nav-link" href=http://tarting.github.io/repository/pysotope/> Project </a>


    <span class="nav-item navbar-text mx-1">/</span>
    <a class="nav-item nav-link" href=http://tarting.github.io/repository/pysotope/config/> Next</a>

</div>
<H1> Readme </H1>
    
        <figure class="avatar">
            <img src="img.jpg"/>
        </figure>
    
    <p>Pysotope uses a hillclimbing algorithm to unmix spike and sample isotope composition, by calculating mass dependent instrument and natural isotope fractionation from a known standard. This yields sample isotope composition and concentration for the element of interest.</p>
<p><a href="https://github.com/tarting/pysotope">github.com/tarting/pysotope</a></p>
<h1 id="installing">Installing</h1>
<hr>
<p>Get a working installation of python e.g. via the Anaconda python distribution
(Used for testing on Windows 10, macOS Mojave, and Manjaro GNU/Linux).</p>
<p>Install the package by downloading/cloning this repository navigating to
the cloned folder and running:</p>
<p>To clone (requires git, <code>$</code> indicates to run as non priveleged user).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ git clone https://github.com/tarting/pysotope
$ <span style="color:#8be9fd;font-style:italic">cd</span> pysotope
$ python setup.py install --user
</code></pre></div><p>This will install the packages listed in the requirements.txt file as well
as the pysotope library and command.</p>
<p>Check that pysotope is installed by importing the pysotope library in
python: Run <code>$ python</code>
in the commandline to launch the python
shell followed by: <code>&gt;&gt;&gt; import pysotope</code> (the <code>&gt;&gt;&gt;</code> indicates a python shell). If no errors are reported, pysotope is installed correctly. Type <code>&gt;&gt;&gt; exit()</code> to
exit the python shell.</p>
<p>To get a list of available commands run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pysotope --help
</code></pre></div><p>Subcommands also yield help texts e.g.:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pysotope init --help
</code></pre></div><h1 id="using-the-command-line-tools">Using the command-line tools</h1>
<hr>
<p>These tools are specifically made for the instruments, naming-convention and
workflow at the UCPH labs.</p>
<p>Pysotope requires a specific directory structure, and works best if
a separate folder is used per sample-set or project. The <code>data_root</code> directory
must contain one appropriate <code>.json</code> specification file and a folder
containing the data as .xls files or .raw folders from the IsoWorks
software.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">| project_root/

    | Cd_data_root/
        | Cd_spec_file.json
        | data_dir/
            | run1 2189.xls
            | run2 2190.xls
            ...
            
    | Cr_data_root/
        | Cr_spec_file.json
        | data_dir/
            | run1.raw/
              | run1 2191.xls
            | run2.raw/
              | run2 2192.xls
            ...

</code></pre></div><p>Running pysotope is then a matter of opening a console, e.g. anaconda
prompt on Windows, or a terminal on macOS and Linux.</p>
<p>Navigate to the <code>data_root</code> directory using the <code>cd</code> commmand and launch the
pysotope command in the following order.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pysotope init <span style="color:#f1fa8c">&#39;data_dir&#39;</span>
</code></pre></div><p>This command generates a list of datafiles saved as external_variables.xlsx. Now
modify this file to include sample weight, spike weight, and spike concentration.
The existing columns can be edited to exclude parts of the recorded data e.g. in
case of missing signal, to exclude entire runs without signal etc.
Any data in columns added to the right of the initial rows will be carried
on to the final results file. Any modifications made to the list persist
through reruns of the init command. In this way you can add more data file
by simply dropping them into the data directory a re-running the pysotope init
command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pysotope invert <span style="color:#f1fa8c">&#39;external_variables.xlsx&#39;</span>
</code></pre></div><p>This command uses the list generated by the init command and the
specification file to invert the double spike data, and produces
a results.xlsx with summarized data for each run, and a
results_cycles.csv containing each collected cycle for every run.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pysotope plot results.xlsx
</code></pre></div><p>This command creates summary diagrams for each bead, and collected summary
for all runs. These are put as png files in a GFX folder. The summary
diagrams display each run in separate colors, cycles excluded from mean
calculation as red crosses, as well as 2 standard deviation and standard
error fields, for both individual runs and summarized across a bead run.</p>
<h1 id="using-as-a-python-module">Using as a python module</h1>
<hr>
<p>Import pysotope:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> pysotope <span style="color:#ff79c6">as</span> pst
</code></pre></div><p>You still need to provide a specification file (described in previous
section), to provide data external to the measurement.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> spec <span style="color:#ff79c6">=</span> pst<span style="color:#ff79c6">.</span>read_json(<span style="color:#f1fa8c">&#39;pysotope/spec/Cr-reduction-scheme-data_only.json&#39;</span>)
</code></pre></div><p>Read the data such that each cycle represented as a list, numpy.array, or
pd.Series of float values in a dictionary containing the key &lsquo;CYCLES&rsquo;.
Given an excel-sheet, csv or pandas dataframe of the format:</p>
<table>
<thead>
<tr>
<th style="text-align:right">Index</th>
<th style="text-align:right">m49</th>
<th style="text-align:right">m50</th>
<th style="text-align:right">m51</th>
<th style="text-align:right">m52</th>
<th style="text-align:right">m53</th>
<th style="text-align:right">m54</th>
<th style="text-align:right">m56</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.5</td>
<td style="text-align:right">0.3</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.3</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.6</td>
<td style="text-align:right">0.4</td>
<td style="text-align:right">0.3</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.5</td>
<td style="text-align:right">0.3</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
</tr>
<tr>
<td style="text-align:right">120</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.5</td>
<td style="text-align:right">0.3</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">0.0</td>
</tr>
</tbody>
</table>
<p>Where the index of the data columns is specified in the spec-file, in
this case with <code>pd.read_[filetype](&lt;file&gt;, index_col=0)</code> index of m49
is 0 and m56 is 6. There can be any number of columns in the datafile as
long as it is indexed correctly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> pandas <span style="color:#ff79c6">as</span> pd

<span style="color:#6272a4">#               sample-ID note  Date-ISO   no-serial number</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> df <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>read(
            <span style="color:#f1fa8c">&#39;datadir/subdir/SPLID-015 500mV 2019-09-01 01-9999.xls&#39;</span>,
            index_col<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>
        )
</code></pre></div><p>Invert the data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> reduced_cycles <span style="color:#ff79c6">=</span> pst<span style="color:#ff79c6">.</span>invert_data(df<span style="color:#ff79c6">.</span>values, spec)
</code></pre></div><p>Where <code>reduced_cycles</code> is an OrderedDict with string index and
numpy.ndarray[float] values.</p>
<p>And summarise:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> summary_statistics <span style="color:#ff79c6">=</span> pst<span style="color:#ff79c6">.</span>summarise_data(reduced_cycles, spec)
</code></pre></div><p>Which is an OrderedDict with string index and float values. These can e.g.
be joined into a pandas dataframe, or be written to a csv file.</p>
    <hr>
<div class="navbar-nav flex-row flex-wrap justify-content-center">


    <a class="nav-item nav-link" href=http://tarting.github.io/repository/pysotope/> Project </a>


    <span class="nav-item navbar-text mx-1">/</span>
    <a class="nav-item nav-link" href=http://tarting.github.io/repository/pysotope/config/> Next</a>

</div>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    <div class="container text-center">
        
            <a href="https://www.researchgate.net/profile/Trygvi-Arting" class="fab fa-researchgate fa-1x" title="Research Gate"></a>
        
            <a href="https://github.com/tarting" class="fab fa-github fa-1x" title="GitHub"></a>
        
            <a href="https://facebook.com/trygvi" class="fab fa-facebook fa-1x" title="Facebook"></a>
        
            <a href="mailto:trygvi@gmail.com" class="fas fa-envelope fa-1x" title="E-mail"></a>
        
    </div>
    
        <div class="container text-center">
            <a href="https://tarting.github.io" title="Trygvi Bech Árting"><small>Trygvi Bech Árting</small></a>
        </div>
    
</div>
</body>
</html>
